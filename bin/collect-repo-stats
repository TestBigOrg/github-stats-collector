#!/usr/bin/env node
const repo = require("../lib/repo");
const program = require('commander');
const fs = require('fs');

program
  .option('-u, --user [username]', 'Get repos for user')
  .option('-o, --output [file]', 'JSON file containing the statistics for each repo')
  .parse(process.argv);


if(!process.env.GITHUB_ACCESS_TOKEN) {
  console.error('GITHUB_ACCESS_TOKEN not set to a valid GitHub access token')
  program.outputHelp();
}

if (program.user && program.output) {
  const writer = fs.createWriteStream(program.output);
  repo.getAllUserRepoStats(program.user, (err, repo) => {
    if(err) {
      console.error(err);
      console.error(err.stack);
    } else {
      writer.write(JSON.stringify(repo) + '\n');
    }
  }, (_, repos) => {
    console.log('Finished collecting stats for', repos.length, 'repos');
  });
} else {
  program.outputHelp();
}
